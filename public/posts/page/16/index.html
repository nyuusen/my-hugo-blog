<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Posts | My New Hugo Site</title>
<meta name="keywords" content="">
<meta name="description" content="Posts - My New Hugo Site">
<meta name="author" content="nyuusen">
<link rel="canonical" href="http://localhost:1313/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css" integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/posts/index.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/">
  <meta property="og:site_name" content="My New Hugo Site">
  <meta property="og:title" content="Posts">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Posts">
<meta name="twitter:description" content="">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My New Hugo Site (Alt + H)">My New Hugo Site</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header">
  <h1>
    Posts
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">NewRelic
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>はじめに 業務でNewRelicを使用しているが基礎的な部分も含めてあまりわかっていないので調べる
進め方 とりあえずNewRelicドキュメントを眺める
New Relic Documentation
NewRelicを使い始める New Relicを使い始める | New Relic Documentation 用語の定義 NewRelic One: 管理画面 テレメトリデータ：パフォーマンスデータ 機能群 アラート アプリケーション異常発生時にSlack等に通知する APM アプリケーションパフォーマンス監視のこと アプリケーションにエージェントを導入し、NewRelicデータベースに保存する 様々な種類のデータを収集・監視できる ブラウザ ウェブサイトのパフォーマンスを監視する 具体的には、ページロードタイムやJavaScriptエラー、ユーザーインタラクションの追跡 ブラウザ側でのユーザーアクションやランタイムエラー、性能が監視できるという理解 ダッシュボード 運用者側でデータを好きなように整理できる エラーインボックス エラー追跡ソリューション あまりわかっていないが、エラーの種類ごとにエラーカウントを出してくれたりする？ インフラストラクチャモニタリング コンテナ等のクラウドインフラのCPUやメモリ、ネットワークトラフィック、ディスク使用量をカバーする ログ ログプロバイダーからログを転送する OpenTelemetry アプリケーションやホストからデータを収集し、NewRelicに送信する データのクエリ NRQL(NewRelicクエリ言語)で詳細な条件でデータを収できる SQLに似ている サービスレベル アプリケーションのサービスレベル指標(SLI)と目標(SLO)を設定して測定できる 合成のモニタリング(Synthetics) 外形監視機能 ユーザーがフロントエンドのアプリやサービスをどのように使用するかをシュミレートできる 脆弱性管理(Vulnerability) ソフトウェアの脆弱性を管理する チュートリアル アラートの作成と管理 Incidents: 条件閾値に違反するイベント Issues: 通知の送信の原因となる1つ以上のインシデントの集合 この2つの違いがあまりわからない アラートを管理するためには、 通知方法をPoliciesとして設定する 通知条件をConditionsとして設定する 例えば、ALBが5xx系のエラーが全体の80%を超えたら、設定済みPoliciesにある「SLack通知する」みたいな条件を作っていく 条件自体は、NRQLでクエリを書く形になる どのようにNewRelicを活用するか どのようにデータを転送するか NewRelicを見る時のポイント</p>
  </div>
  <footer class="entry-footer"><span title='2024-10-04 22:32:31 +0900 JST'>October 4, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;nyuusen</footer>
  <a class="entry-link" aria-label="post link to NewRelic" href="http://localhost:1313/posts/newrelic/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">UUIDやULID
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>概要 データベース設計において、AutoIncrementな純粋な番号(連番)の他にUUIDやULIDがあるけど、それらの違いと結局どれ使えば良いのかという話。
連番の欠点 まず最初に脳死で設計する時に選択肢となる連番の欠点について理解してみる。
リソースの特定の容易になる システム規模(会員数)が推測されやすい この辺りが挙げられる。セキュリティ面(悪意あるユーザーに攻撃される)以外においても、競合他社から容易にシステムのことを推測されやすくなり、優位にビジネスを進められてしまうみたいなこともあるかもしれない。
UUID UUIDとは何か？特徴を列挙する。
Universally Unique Identifier 128bit 複数のバージョンが存在する v4: 全てのビットをランダム値にする（生成が簡単で、一意性が高い） 128ビットのうち、特定の4ビット（バージョンフィールド）を0100に設定する 次に、特定の2ビット（バリアントフィールド）を10に設定する（これにより、UUIDがRFC 4122に準拠していることを示す） v7: v4をソート可能にしたもの 現在のタイムスタンプをミリ秒単位で取得し、48ビットのビット列に変換する 残りの80ビットを暗号学的に安全な乱数で埋める ULID 続いて、ULIDとは何か？特徴を列挙する。
Universally Unique Lexicographically Sortable Identifier UUIDの欠点を補う形で設計された一意識別子 時系列順にソート可能で、データの管理や検索が容易 UUIDと比べて短く、URLなどで使用する際に便利 生成方法 タイムスタンプの取得：現在のタイムスタンプをミリ秒単位で取得し、48ビットのビット列に変換 残りの80ビットをランダムな値で埋める 生成されたビット列をCrockford’s Base32でエンコード UUID v7とULIDの違い UUID v7とULIDの違いをまとめる。基本的にはULIDの方が優れているように感じる。
文字数 UUIDv7：ハイフンを含む36字 ULID：特殊文字を含まない26文字 ランダム部 UUIDv7：12bit &#43; 62bit ULID：80bit 特殊文字の使用 UUIDv7：ハイフンを含む ULID：特殊文字を含まない） UUIDやULIDの欠点 連番より優れていそうなUUIDやULIDだが、以下のような欠点もある。
インデックスには不都合があり、クエリパフォーマンスが低下する UUID v4はソートができない UUID v7とULIDは生成時間が漏洩するリスクがある クエリパフォーマンスが低下するについて深堀りする 「インデックスには不都合があり、クエリパフォーマンスが低下する」というだけでは納得できないので、ちょっと深堀りしてみる。
MySQL(InnoDB)の話になるが、主キーのインデックスとしてクラスタインデックスがある。
これはキーの値を比較した順序が近いほど物理的に近接した場所にレコードのデータが配置されるため、連番の場合は、連続して投入されたデータはディスク上に近い場所にあり、キャッシュの恩恵が受けられる。
UUID(v4)は、書き込み先がランダムになるので、キャッシュヒットの割合が下がり、パフォーマンスが低下する。
一方、UUID v7やULIDは先頭48bitがタイムスタンプであり、クラスタインデックス上でも投入順に隣接して格納される。
PostgreSQLは、主キーインデックスとは別の領域にレコードデータが保存されるため、このような制約がない。何なら標準でUUID型も用意されている。
結論 結論としては、その時のケースによって使い分ければ良いのかなと思う。
完全な個人的な意見ではあるが、ユーザーに露出するデータはUUID v7 or ULIDにして、それ以外は連番で良いのかなと思った。
UUID v4はあえて使うシーンはなさそうかなという印象。
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-10-04 22:32:31 +0900 JST'>October 4, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;nyuusen</footer>
  <a class="entry-link" aria-label="post link to UUIDやULID" href="http://localhost:1313/posts/uuid-ulid/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">システムリプレイス
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>はじめに あるtoCサービスのリプレイスの話
システム構成 フロントエンド: HTML/JavaScript S3に静的ホスティング バックエンド: TypeScript/Fastify ECS on Fargate データベース: RDS キャッシュ: CloudFront Firewall: AWS WAF リプレイスの概要 現在稼働しているシステムの運用会社の変更に伴うリプレイス AWSアカウント自体も変更になる サービス自体は、別の外部サービスへの送客するだけの小さいサービス 進め方 (事前)新環境の開発&amp;デプロイ 非公開状態 現環境をメンテナンスモード 誤って旧環境でデータ作成等が行われないようにする 現環境→新環境にデータ移行 事前にデータ移行用のバッチを作成 新環境の動作が問題ないかをテスト 社内ネットワークのみに公開する 新環境のIP制限を解除し、外部に公開 勉強になったポイント データ移行バッチで扱うデータ量が多く、移行時にAWSマネージドサービスを使用する場合は、スロットリング制限を考慮して実装を行う 今回はAWS KMSを使用して一部データを暗号化していたので、何も考えずに実装したらスロットリング制限に引っかかってしまった データ移行前に、現環境はメンテナンスモードにする 万が一、データ移行中等に現環境の方にデータが作成されてしまったら、移行対象外となり、障害発生の可能性がある メンテナンスモードに切り替える際にCloud Frontのオリジンを変更する場合は、キャッシュ保持期間に気を付ける キャッシュのInvalidateを行わないと、普通のページにアクセスできてしまう恐れがある (新環境リリース後)現環境メンテナンスモード内に配置するリンク等は新環境のものにしておく オートリダイレクトにするのもあり HTMLならmeta refreshでできる &lt;meta http-equiv=&#34;refresh&#34; content=&#34;リダイレクトするまでの秒数; URL=新URL&#34;&gt; APIなら、HeaderのLocationフィールドに新URLをセットして30x系のリダイレクトのHTTPステータスコードを返す JavaScriptを使用するのも可能だが、SEO的に微妙らしい </p>
  </div>
  <footer class="entry-footer"><span title='2024-10-04 22:32:31 +0900 JST'>October 4, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;nyuusen</footer>
  <a class="entry-link" aria-label="post link to システムリプレイス" href="http://localhost:1313/posts/system-replace/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">リダイレクトについて
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>はじめに リダイレクト3xx系のHTTPステータスコードについて調べた。 歴史的背景とかが絡んで、仕様と実態の乖離等が発生し、わかりづらいものになっているらしいので整理。
301 Moved Permanently リクエストされたリソースが完全にHTTPヘッダーのLocationで示されたURLに移動したことを示す ブラウザはこのURLにリダイレクトするが、検索エンジンはリソースへのリンクを更新する 一部の古いクライアントでは、不正にメソッドがGETに書き換えられる恐れがあるので、GETリクエストのみで使用する SEO的には最も優れている？ 参考: 301 Moved Permanently - HTTP | MDN 302 Found リクエストされたリソースが一時的にHTTPヘッダーのLocationで示されたURLに移動したことを示す ブラウザはこのURLにリダイレクトするが、検索エンジンはリソースへのリンクを更新しない 一部の古いクライアントでは、不正にメソッドがGETに書き換えられる恐れがあるので、GETリクエストのみで使用する 参考: 302 Found - HTTP | MDN 303 See Other リダイレクトが新しくアップロードされたリソースではなく、 (確認ページやアップロード進捗ページのような) 別なページにリンクすることを示す PUTやPOSTの結果として送り返される リダイレクト先の表示にはGETを使用する 参考: 303 See Other - HTTP | MDN 307 Temporary Redirect リクエストされたリソースが一時的にHTTPヘッダーのLocationで示されたURLに移動したことを示す リクエストメソッドと本文が変更されないことが保証される 使用されるメソッドをGETに変更したい場合は303を使用する 参考: 307 Temporary Redirect - HTTP | MDN 308 Permanent Redirect リクエストされたリソースが完全にHTTPヘッダーのLocationで示されたURLに移動したことを示す(301と同じ) リクエストメソッドと本文が変更されないことが保証される 参考: 308 Permanent Redirect - HTTP | MDN ステータスコード別のユースケース ではどれを使えば良いのかというのを調べてみる
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-10-04 22:32:31 +0900 JST'>October 4, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;nyuusen</footer>
  <a class="entry-link" aria-label="post link to リダイレクトについて" href="http://localhost:1313/posts/redirect/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Environments
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>Environmentsとは GitHubActionsの機能であり、リポジトリに設定できるもの 環境ごとにプロテクションルールや変数、シークレットを保持することができ、環境を指定して、ワークフローを指定することで、必要な権限のみでデプロイを実行できたりする デプロイに環境の使用 - GitHub Docs 使い方 Environmentsの設定自体はGitHubの管理画面のSettingsから設定が可能 ワークフローからはenvironmentフィールドにEnvironmentsの環境名を指定する ユースケース 環境ごとに必要な変数やシークレットを使用する 例えば環境ごとに適切なAWSのロールを設定することで、セキュリティ性を向上させることができる 参考 [GitHub Actions] ブランチごとにジョブの実行を制御できる Environments を試してみた | DevelopersIO </p>
  </div>
  <footer class="entry-footer"><span title='2024-08-16 10:56:56 +0900 JST'>August 16, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;nyuusen</footer>
  <a class="entry-link" aria-label="post link to Environments" href="http://localhost:1313/posts/environments/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/posts/page/15/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="http://localhost:1313/posts/page/17/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My New Hugo Site</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
